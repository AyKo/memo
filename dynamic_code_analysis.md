# 動的解析：不正メモリアクセス

## 動機
メモリの不正アクセスしているようだが、即座にSIGSEGVが発生するような分かりやすいものでないようだ。

## 回答
動的解析ツールを用いると、メモリの不正アクセスがあったことを検出できるかもしれない。

私が使うものでは、MALLOC_CHECK_・Valgrind・Mudflapがある。それぞれに特徴があり状況によって使い分けるのがよい。 
これらツールの特徴の一覧を以下に示す：

ツール名        | 要インストール | ヒープメモリ不正アクセス検出 | スタック領域不正アクセス検出 | メモリリーク検出 | 動作速度 | 再コンパイル
------------- | ------------- | -------------------------- | ------------------------- | --------------- | ------- | ---------
MALLOCK_CHECK_ | 不要 | △ | ×  | × | 〇 | 不要
Valgrind       | 必要 | 〇 | ×  | 〇 | × | 不要
Mudflap        | 必要 | 〇 | 〇 | 〇 | 〇 | 必要

### MALLOC_CHECK_
MALLOC_CHECK_を用いると、ヒープメモリの不正アクセスを検出できる。
OSの基本ライブラリ(glibc)に導入されているので、準備が不要であること、ほとんどパフォーマンスに影響がないのが強みである。二重free()や管理領域の破壊を検出できる。
検出時、警告の表示やプログラムのabort()をさせる(Coreダンプの出力を見越して）こともできる。

### Valgrind
Valgrindを用いると、メモリリーク、ヒープメモリの不正アクセスを検出できる。
Valgrind上でプログラムを動作させ、全てのヒープメモリのアクセスを監視する。
そのため動作はかなり遅くなるが、再コンパイルは不要で鵜ヒープメモリに関するバグの検出効率は高品質である。

### Mudflap
Mudflapを用いると、メモリリーク、ヒープメモリの不正アクセス、スタック領域の不正アクセスを検出できる。
Valgrindと異なり、パフォーマンスへの影響が少なく、スタック領域の不正アクセスも検出できるがプログラムの再コンパイルが必要となる。

## 参考文書
上記のツールの紹介、具体的な使用例
- 高林哲、鵜飼文敏、佐藤祐介、浜地慎一郎、首藤一幸（2006）『Binary Hacks　―ハッカー秘伝のテクニック100選』オライリー・ジャパン
