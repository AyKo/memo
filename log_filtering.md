# ログ解析のためにフィルタしたい

## 動機
　ログファイルが大量に出力される。取捨選択、場合によっては変換・解析をおこなわないと解析が難しい。

## 回答
ログ解析を効率的におこなうためには、以下のコマンドをいくらかは使えることが必須と考える（使いこなすほどでなくてもよい）：
- grep: 取捨選択
- awk(gawk): 取捨選択(・変換・解析)
- sed: 変換
- tput: 色などの文字修飾
また、grep/awk/sedは正規表現がいくらかは使えたほうが適用幅が広がる。

基本的な説明はmanやWEBで見たほうがよいためここでは省くが、特に簡単かつ強力と考えるものを以下に示す。

### grep
オプションなしならマッチする文字列を表示。以下はマッチに対して拡張するオプション：
- 「-v」　指定した文字列以外
- 複数の「-e <文字列>」　いずれかの文字列
- 「-A <行数>」　指定した文字列および<行数>前
- 「-B <行数>」　指定した文字列および<行数>後
- 「-C <行数>」　指定した文字列および<行数>前後

### awk(gawk)
１行ごとにマッチルールとその行への制御を書ける。少し分かるだけで取捨選択の拡張に用いることができる：
- ２番目のフィールドが１０以上の行を表示   
   ``` gawk '$2>=10' ```
- ３番目のフィールドだけ表示  
   ``` gawk '{print $3}' ```
- importantの文字列を含み３番目のフィールドが2以上の行について表示  
  ``` gawk '/important/ && $3>=2 {print $0}' ```

### sed
フィルター処理でファイルを編集するコマンド。文字列の置き換えだけ知れば当面十分と考える。 
次項に述べるtputと組み合わせて、重要な箇所の文字列の色を変えたりもできる。
- 192.168.1.10をTARGETに置き換える   
  ``` sed 's/192\.168\.1\.10/TARGET/g' ```
- Debugの文字列を全て消す  
  ``` sed 's/Debug//g' ```

### tput
端末制御に使うコマンド。エスケープシーケンスの出力をコマンドからできる。
実行文字に色などをつけることができるので、ログ解析時に特に注目したい文字列を強調できる。
``` tput <名前> <パラメータ> ``` で指定する。
ログ解析時においては、sedコマンドと組み合わせるとよい。

名前とパラメータについては「man terminfo」で調べられる。特に頻出する名前は以下の通り：
- setaf [色番号]　文字色の変更
- setab [色番号]　背景色の変更
- rev　反転
- sgr0　文字修飾の解除
	
sedコマンドとの組み合わせの例：
- ERRORの文字列を赤くする  
  ``` sed 's/ERROR/'$(tput setaf 1)'ERROR'$(tput sgr0)'/g' ```  
  （わかりやすく書くと『sed 's/ERROR/[赤]ERROR[解除]/g'』）
- WARNINGの文字列がある行を反転する  
  ``` sed 's/.*WARNING.*/'$(tput rev)'\0'$(tput sgr0)'/' ```  
  （「\0」はマッチした文字列全体）
